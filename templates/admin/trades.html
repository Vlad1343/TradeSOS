{% extends "base.html" %}

{% block title %}Manage Trades - Admin - TradeSOS{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
        <div>
            <h1 style="color: var(--tradesos-red); font-size: 2.5rem; margin-bottom: 10px;">MANAGE TRADE PROFESSIONALS</h1>
            <p style="color: var(--tradesos-gray-text); font-size: 1.1rem;">Verify and manage trade professional accounts</p>
        </div>
        <a href="{{ url_for('admin_dashboard') }}" style="background: var(--tradesos-gray-dark); color: var(--tradesos-black); padding: 12px 20px; text-decoration: none; border-radius: 5px; font-weight: 600;">
            <i class="fas fa-arrow-left" style="margin-right: 8px;"></i>BACK TO DASHBOARD
        </a>
    </div>

    <!-- Filters and Search -->
    <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 30px;">
        <h3 style="color: var(--tradesos-red); margin-bottom: 20px;">
            <i class="fas fa-filter" style="margin-right: 10px;"></i>FILTER OPTIONS
        </h3>
        <form method="GET" style="display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 15px; align-items: end;">
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--tradesos-black);">Search</label>
                <input type="text" name="search" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 14px;" 
                       placeholder="Company name or email" 
                       value="{{ request.args.get('search', '') }}">
            </div>
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--tradesos-black);">Verification Status</label>
                <select name="verified" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 14px;">
                    <option value="">All</option>
                    <option value="true" {{ 'selected' if request.args.get('verified') == 'true' }}>Verified</option>
                    <option value="false" {{ 'selected' if request.args.get('verified') == 'false' }}>Pending</option>
                </select>
            </div>
            <div>
                <label style="display: block; margin-bottom: 5px; font-weight: 600; color: var(--tradesos-black);">Plan Type</label>
                <select name="plan" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 5px; font-size: 14px;">
                    <option value="">All Plans</option>
                    <option value="standard" {{ 'selected' if request.args.get('plan') == 'standard' }}>Standard</option>
                    <option value="premium" {{ 'selected' if request.args.get('plan') == 'premium' }}>Premium</option>
                </select>
            </div>
            <button type="submit" style="background: var(--tradesos-red); color: white; padding: 10px 20px; border: none; border-radius: 5px; font-weight: 600; cursor: pointer;">
                <i class="fas fa-search" style="margin-right: 8px;"></i>FILTER
            </button>
        </form>
    </div>

    <!-- Bulk Actions -->
    <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h4 style="color: var(--tradesos-red); margin: 0;">
                <i class="fas fa-users" style="margin-right: 10px;"></i>TRADE PROFESSIONALS
                <span style="background: var(--tradesos-gray-dark); color: var(--tradesos-black); padding: 4px 12px; border-radius: 15px; margin-left: 10px; font-size: 14px;">{{ trades.total if trades else 0 }}</span>
            </h4>
            <div style="display: flex; gap: 10px;">
                <button style="background: #28a745; color: white; padding: 8px 16px; border: none; border-radius: 5px; font-weight: 600; cursor: pointer;" onclick="verifySelected()">
                    <i class="fas fa-check" style="margin-right: 5px;"></i>VERIFY SELECTED
                </button>
                <button style="background: #ffc107; color: black; padding: 8px 16px; border: none; border-radius: 5px; font-weight: 600; cursor: pointer;" onclick="unverifySelected()">
                    <i class="fas fa-times" style="margin-right: 5px;"></i>UNVERIFY SELECTED
                </button>
            </div>
        </div>
    </div>

    <!-- Trades List -->
    <div style="background: white; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        {% if trades and trades.items %}
            <!-- Table Header -->
            <div style="background: var(--tradesos-gray); padding: 15px 20px; border-radius: 8px 8px 0 0; display: grid; grid-template-columns: 30px 2fr 1.5fr 1fr 1fr 1fr 1fr 100px; gap: 15px; font-weight: 600; border-bottom: 2px solid #ddd;">
                <input type="checkbox" id="selectAll" onchange="toggleAll()" style="transform: scale(1.2);">
                <div>COMPANY</div>
                <div>CONTACT</div>
                <div>SKILLS</div>
                <div>COVERAGE</div>
                <div>STATUS</div>
                <div>PLAN</div>
                <div>ACTIONS</div>
            </div>

            <!-- Trade Rows -->
            {% for trade in trades.items %}
            <div style="padding: 20px; border-bottom: 1px solid #eee; display: grid; grid-template-columns: 30px 2fr 1.5fr 1fr 1fr 1fr 1fr 100px; gap: 15px; align-items: center; transition: background 0.3s;" onmouseover="this.style.background='#f8f9fa'" onmouseout="this.style.background='white'">
                <input type="checkbox" class="trade-checkbox" value="{{ trade.id }}" style="transform: scale(1.2);">
                
                <div>
                    <strong style="color: var(--tradesos-black); font-size: 16px;">{{ trade.company }}</strong>
                    {% if trade.vat_number %}
                        <br><small style="color: var(--tradesos-gray-text);">VAT: {{ trade.vat_number }}</small>
                    {% endif %}
                </div>
                
                <div>
                    <div style="color: var(--tradesos-black);">{{ trade.user.email if trade.user else 'N/A' }}</div>
                    <small style="color: var(--tradesos-gray-text);">Reg: {{ trade.created_at.strftime('%d/%m/%Y') }}</small>
                </div>
                
                <div>
                    {% if trade.get_skills() %}
                        {% for skill in trade.get_skills()[:2] %}
                            <span style="background: var(--tradesos-gray-dark); color: var(--tradesos-black); padding: 3px 8px; border-radius: 12px; font-size: 12px; margin-right: 5px; margin-bottom: 3px; display: inline-block;">{{ skill }}</span>
                        {% endfor %}
                        {% if trade.get_skills()|length > 2 %}
                            <span style="color: var(--tradesos-gray-text); font-size: 12px;">+{{ trade.get_skills()|length - 2 }}</span>
                        {% endif %}
                    {% else %}
                        <span style="color: var(--tradesos-gray-text);">None listed</span>
                    {% endif %}
                </div>
                
                <div>
                    {% if trade.get_coverage_areas() %}
                        {% for area in trade.get_coverage_areas()[:2] %}
                            <span style="background: #17a2b8; color: white; padding: 3px 8px; border-radius: 12px; font-size: 12px; margin-right: 5px; margin-bottom: 3px; display: inline-block;">{{ area }}</span>
                        {% endfor %}
                        {% if trade.get_coverage_areas()|length > 2 %}
                            <span style="color: var(--tradesos-gray-text); font-size: 12px;">+{{ trade.get_coverage_areas()|length - 2 }}</span>
                        {% endif %}
                    {% else %}
                        <span style="color: var(--tradesos-gray-text);">Not set</span>
                    {% endif %}
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 5px;">
                    {% if trade.verified %}
                        <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; text-align: center;">
                            <i class="fas fa-check-circle"></i> VERIFIED
                        </span>
                    {% else %}
                        <span style="background: #ffc107; color: black; padding: 4px 8px; border-radius: 12px; font-size: 12px; text-align: center;">
                            <i class="fas fa-clock"></i> PENDING
                        </span>
                    {% endif %}
                    
                    {% if trade.insurance_document_url %}
                        <span style="background: #17a2b8; color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; text-align: center;">
                            <i class="fas fa-shield-alt"></i> INSURED
                        </span>
                    {% else %}
                        <span style="background: var(--tradesos-red); color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; text-align: center;">
                            <i class="fas fa-exclamation-triangle"></i> NO INSURANCE
                        </span>
                    {% endif %}
                </div>
                
                <div style="text-align: center;">
                    <span style="background: {{ '#ffc107' if trade.plan_tier == 'premium' else 'var(--tradesos-gray-dark)' }}; color: {{ 'black' if trade.plan_tier == 'premium' else 'var(--tradesos-black)' }}; padding: 6px 10px; border-radius: 12px; font-size: 12px; font-weight: 600;">
                        {% if trade.plan_tier == 'premium' %}
                            <i class="fas fa-crown"></i> PREMIUM
                        {% else %}
                            <i class="fas fa-user"></i> STANDARD
                        {% endif %}
                    </span>
                    {% if trade.subscription_status %}
                        <br><small style="color: var(--tradesos-gray-text); font-size: 10px;">{{ trade.subscription_status.title() }}</small>
                    {% endif %}
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 5px;">
                    <a href="{{ url_for('verify_trade', trade_id=trade.id) }}" 
                       style="background: {{ 'var(--tradesos-red)' if not trade.verified else '#ffc107' }}; color: white; padding: 6px 8px; text-decoration: none; border-radius: 4px; text-align: center; font-size: 12px; font-weight: 600;"
                       onclick="return confirm('{{ 'Verify' if not trade.verified else 'Unverify' }} {{ trade.company }}?')"
                       title="{{ 'Verify' if not trade.verified else 'Unverify' }} Trade">
                        <i class="fas fa-{{ 'check' if not trade.verified else 'times' }}"></i>
                    </a>
                    
                    {% if trade.insurance_document_url %}
                        <a href="{{ trade.insurance_document_url }}" 
                           style="background: #17a2b8; color: white; padding: 6px 8px; text-decoration: none; border-radius: 4px; text-align: center; font-size: 12px;"
                           target="_blank"
                           title="View Insurance Document">
                            <i class="fas fa-file-alt"></i>
                        </a>
                    {% endif %}
                    
                    <button style="background: var(--tradesos-gray-dark); color: var(--tradesos-black); padding: 6px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;" 
                            onclick="viewTradeDetails({{ trade.id }})"
                            title="View Details">
                        <i class="fas fa-eye"></i>
                    </button>
                </div>
            </div>
            {% endfor %}

            <!-- Pagination -->
            {% if trades.pages > 1 %}
            <div style="padding: 20px; background: var(--tradesos-gray); border-radius: 0 0 8px 8px;">
                <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
                    {% if trades.has_prev %}
                        <a href="{{ url_for('admin_trades', page=trades.prev_num, **request.args) }}" style="background: var(--tradesos-red); color: white; padding: 8px 12px; text-decoration: none; border-radius: 4px;">
                            <i class="fas fa-chevron-left"></i>
                        </a>
                    {% endif %}
                    
                    {% for page_num in trades.iter_pages() %}
                        {% if page_num %}
                            {% if page_num != trades.page %}
                                <a href="{{ url_for('admin_trades', page=page_num, **request.args) }}" style="background: white; color: var(--tradesos-black); padding: 8px 12px; text-decoration: none; border-radius: 4px; border: 1px solid #ddd;">
                                    {{ page_num }}
                                </a>
                            {% else %}
                                <span style="background: var(--tradesos-red); color: white; padding: 8px 12px; border-radius: 4px; font-weight: bold;">{{ page_num }}</span>
                            {% endif %}
                        {% else %}
                            <span style="color: var(--tradesos-gray-text);">...</span>
                        {% endif %}
                    {% endfor %}
                    
                    {% if trades.has_next %}
                        <a href="{{ url_for('admin_trades', page=trades.next_num, **request.args) }}" style="background: var(--tradesos-red); color: white; padding: 8px 12px; text-decoration: none; border-radius: 4px;">
                            <i class="fas fa-chevron-right"></i>
                        </a>
                    {% endif %}
                </div>
            </div>
            {% endif %}

        {% else %}
            <div style="text-align: center; padding: 60px 20px;">
                <i class="fas fa-users" style="font-size: 4rem; color: var(--tradesos-gray-dark); margin-bottom: 20px;"></i>
                <h4 style="color: var(--tradesos-gray-text); margin-bottom: 10px;">No trades found</h4>
                <p style="color: var(--tradesos-gray-text);">Try adjusting your search filters or check back later for new applications.</p>
            </div>
        {% endif %}
    </div>
</div>

<!-- Trade Details Modal -->
<div id="tradeDetailsModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;" onclick="closeModal()">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 8px; max-width: 600px; width: 90%;" onclick="event.stopPropagation()">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3 style="color: var(--tradesos-red); margin: 0;">Trade Details</h3>
            <button onclick="closeModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--tradesos-gray-text);">×</button>
        </div>
        <div id="tradeDetailsContent">
            <!-- Content loaded via JavaScript -->
        </div>
    </div>
</div>

<script>
function toggleAll() {
    const selectAll = document.getElementById('selectAll');
    const checkboxes = document.querySelectorAll('.trade-checkbox');
    
    checkboxes.forEach(checkbox => {
        checkbox.checked = selectAll.checked;
    });
}

function getSelectedTrades() {
    const checkboxes = document.querySelectorAll('.trade-checkbox:checked');
    return Array.from(checkboxes).map(cb => cb.value);
}

function verifySelected() {
    const selected = getSelectedTrades();
    if (selected.length === 0) {
        alert('Please select trades to verify.');
        return;
    }
    
    if (confirm(`Verify ${selected.length} selected trade(s)?`)) {
        // In a real app, this would send an AJAX request
        alert(`Would verify trades: ${selected.join(', ')}`);
    }
}

function unverifySelected() {
    const selected = getSelectedTrades();
    if (selected.length === 0) {
        alert('Please select trades to unverify.');
        return;
    }
    
    if (confirm(`Unverify ${selected.length} selected trade(s)?`)) {
        // In a real app, this would send an AJAX request
        alert(`Would unverify trades: ${selected.join(', ')}`);
    }
}

function viewTradeDetails(tradeId) {
    const modal = document.getElementById('tradeDetailsModal');
    const modalContent = document.getElementById('tradeDetailsContent');
    
    modalContent.innerHTML = `
        <div style="text-align: center; padding: 20px;">
            <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: var(--tradesos-red);"></i>
            <p style="margin-top: 10px; color: var(--tradesos-gray-text);">Loading trade details...</p>
        </div>
    `;
    
    modal.style.display = 'block';
    
    // Fetch actual trade details
    fetch(`/admin/trade-details/${tradeId}`)
        .then(response => response.json())
        .then(trade => {
            modalContent.innerHTML = `
                <div style="max-height: 600px; overflow-y: auto;">
                    <!-- Company Information -->
                    <div style="background: var(--tradesos-gray); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--tradesos-red); margin-bottom: 15px;">
                            <i class="fas fa-building" style="margin-right: 10px;"></i>COMPANY INFORMATION
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <strong>Company Name:</strong><br>
                                <span style="color: var(--tradesos-gray-text);">${trade.company || 'Not provided'}</span>
                            </div>
                            <div>
                                <strong>Email Address:</strong><br>
                                <span style="color: var(--tradesos-gray-text);">${trade.email || 'Not provided'}</span>
                            </div>
                            <div>
                                <strong>Companies House Number:</strong><br>
                                <span style="color: var(--tradesos-gray-text);">${trade.companies_house_number || 'Not provided'}</span>
                            </div>
                            <div>
                                <strong>VAT Registration:</strong><br>
                                <span style="color: var(--tradesos-gray-text);">${trade.vat_number || 'Not provided'}</span>
                            </div>
                            <div>
                                <strong>UTR Number:</strong><br>
                                <span style="color: var(--tradesos-gray-text);">${trade.utr_number || 'Not provided'}</span>
                            </div>
                            <div>
                                <strong>Registration Date:</strong><br>
                                <span style="color: var(--tradesos-gray-text);">${trade.created_at}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Trade Skills & Coverage -->
                    <div style="background: var(--tradesos-gray); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--tradesos-red); margin-bottom: 15px;">
                            <i class="fas fa-tools" style="margin-right: 10px;"></i>TRADE SKILLS & COVERAGE
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <strong>Trade Skills:</strong><br>
                                <div style="margin-top: 5px;">
                                    ${trade.skills && trade.skills.length > 0 
                                        ? trade.skills.map(skill => `<span style="background: var(--tradesos-red); color: white; padding: 3px 8px; border-radius: 12px; font-size: 12px; margin-right: 5px; margin-bottom: 3px; display: inline-block;">${skill}</span>`).join('')
                                        : '<span style="color: var(--tradesos-gray-text);">No skills listed</span>'
                                    }
                                </div>
                            </div>
                            <div>
                                <strong>Coverage Areas:</strong><br>
                                <div style="margin-top: 5px;">
                                    ${trade.coverage_areas && trade.coverage_areas.length > 0 
                                        ? trade.coverage_areas.map(area => `<span style="background: #17a2b8; color: white; padding: 3px 8px; border-radius: 12px; font-size: 12px; margin-right: 5px; margin-bottom: 3px; display: inline-block;">${area}</span>`).join('')
                                        : '<span style="color: var(--tradesos-gray-text);">No coverage areas set</span>'
                                    }
                                </div>
                            </div>
                            <div>
                                <strong>Service Radius:</strong><br>
                                <span style="color: var(--tradesos-gray-text);">${trade.radius_km ? trade.radius_km + ' km' : 'Not specified'}</span>
                            </div>
                            <div>
                                <strong>Coverage Districts:</strong><br>
                                <div style="margin-top: 5px;">
                                    ${trade.coverage_districts && trade.coverage_districts.length > 0 
                                        ? trade.coverage_districts.map(district => `<span style="background: var(--tradesos-gray-dark); color: var(--tradesos-black); padding: 3px 8px; border-radius: 12px; font-size: 12px; margin-right: 5px; margin-bottom: 3px; display: inline-block;">${district}</span>`).join('')
                                        : '<span style="color: var(--tradesos-gray-text);">No specific districts</span>'
                                    }
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Documents & Verification -->
                    <div style="background: var(--tradesos-gray); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--tradesos-red); margin-bottom: 15px;">
                            <i class="fas fa-file-alt" style="margin-right: 10px;"></i>DOCUMENTS & VERIFICATION
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <strong>Insurance Certificate:</strong><br>
                                ${trade.insurance_document_url 
                                    ? `<a href="${trade.insurance_document_url}" target="_blank" style="background: #28a745; color: white; padding: 6px 12px; text-decoration: none; border-radius: 4px; font-size: 12px; display: inline-block; margin-top: 5px;"><i class="fas fa-download"></i> VIEW DOCUMENT</a>`
                                    : '<span style="color: var(--tradesos-red); font-weight: bold;">❌ NOT UPLOADED</span>'
                                }
                            </div>
                            <div>
                                <strong>Verification Status:</strong><br>
                                <span style="background: ${trade.verified ? '#28a745' : '#ffc107'}; color: ${trade.verified ? 'white' : 'black'}; padding: 6px 12px; border-radius: 12px; font-size: 12px; font-weight: bold; margin-top: 5px; display: inline-block;">
                                    <i class="fas fa-${trade.verified ? 'check-circle' : 'clock'}"></i> ${trade.verified ? 'VERIFIED' : 'PENDING APPROVAL'}
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Subscription & Performance -->
                    <div style="background: var(--tradesos-gray); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                        <h4 style="color: var(--tradesos-red); margin-bottom: 15px;">
                            <i class="fas fa-chart-line" style="margin-right: 10px;"></i>SUBSCRIPTION & PERFORMANCE
                        </h4>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <strong>Plan Tier:</strong><br>
                                <span style="background: ${trade.plan_tier === 'premium' ? '#ffc107' : 'var(--tradesos-gray-dark)'}; color: ${trade.plan_tier === 'premium' ? 'black' : 'var(--tradesos-black)'}; padding: 6px 12px; border-radius: 12px; font-size: 12px; font-weight: bold; margin-top: 5px; display: inline-block;">
                                    <i class="fas fa-${trade.plan_tier === 'premium' ? 'crown' : 'user'}"></i> ${trade.plan_tier.toUpperCase()}
                                </span>
                            </div>
                            <div>
                                <strong>Subscription Status:</strong><br>
                                <span style="color: var(--tradesos-gray-text); margin-top: 5px; display: inline-block;">${trade.subscription_status || 'inactive'}</span>
                            </div>
                            <div>
                                <strong>Customer Rating:</strong><br>
                                <span style="color: var(--tradesos-gray-text); margin-top: 5px; display: inline-block;">
                                    ${trade.review_count > 0 
                                        ? `${trade.rating_avg.toFixed(1)}/5 ⭐ (${trade.review_count} reviews)`
                                        : 'No reviews yet'
                                    }
                                </span>
                            </div>
                            <div>
                                <strong>Stripe Customer ID:</strong><br>
                                <span style="color: var(--tradesos-gray-text); margin-top: 5px; display: inline-block; font-family: monospace; font-size: 11px;">${trade.stripe_customer_id || 'Not set'}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div style="background: white; padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="display: flex; gap: 15px; justify-content: center;">
                            <a href="/admin/verify-trade/${trade.id}" 
                               onclick="return confirm('${trade.verified ? 'Unverify' : 'Verify'} ${trade.company}?')"
                               style="background: ${trade.verified ? '#ffc107' : '#28a745'}; color: ${trade.verified ? 'black' : 'white'}; padding: 12px 24px; text-decoration: none; border-radius: 5px; font-weight: bold;">
                                <i class="fas fa-${trade.verified ? 'times' : 'check'}"></i> ${trade.verified ? 'REVOKE VERIFICATION' : 'APPROVE & VERIFY'}
                            </a>
                            ${trade.insurance_document_url 
                                ? `<a href="${trade.insurance_document_url}" target="_blank" style="background: #17a2b8; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; font-weight: bold;"><i class="fas fa-file-alt"></i> VIEW INSURANCE</a>`
                                : ''
                            }
                            <button onclick="closeModal()" style="background: var(--tradesos-gray-dark); color: var(--tradesos-black); padding: 12px 24px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer;">
                                <i class="fas fa-times"></i> CLOSE
                            </button>
                        </div>
                    </div>
                </div>
            `;
        })
        .catch(error => {
            modalContent.innerHTML = `
                <div style="background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 15px; border-radius: 5px; text-align: center;">
                    <i class="fas fa-exclamation-triangle" style="margin-right: 10px;"></i>
                    <strong>Error loading trade details</strong><br>
                    <small>Please try again or contact system administrator.</small>
                </div>
            `;
        });
}

function closeModal() {
    document.getElementById('tradeDetailsModal').style.display = 'none';
}
</script>
{% endblock %}