{% extends "base.html" %}

{% block title %}Admin Dashboard - TradeSOS{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
    <div style="text-align: center; margin-bottom: 40px;">
        <h1 style="color: var(--tradesos-red); font-size: 2.5rem; margin-bottom: 10px;">ADMIN DASHBOARD</h1>
        <p style="color: var(--tradesos-gray-text); font-size: 1.1rem;">Manage TradeSOS platform operations and users</p>
    </div>

    <!-- Statistics Overview -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px;">
        <div style="background: var(--tradesos-red); color: white; padding: 30px; border-radius: 8px; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
            <i class="fas fa-users" style="font-size: 2rem; margin-bottom: 15px;"></i>
            <h3 style="margin-bottom: 5px;">{{ stats.total_users or 0 }}</h3>
            <p style="margin: 0; opacity: 0.9;">Total Users</p>
        </div>
        <div style="background: var(--tradesos-black); color: white; padding: 30px; border-radius: 8px; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
            <i class="fas fa-home" style="font-size: 2rem; margin-bottom: 15px;"></i>
            <h3 style="margin-bottom: 5px;">{{ stats.total_customers or 0 }}</h3>
            <p style="margin: 0; opacity: 0.9;">Customers</p>
        </div>
        <div style="background: #28a745; color: white; padding: 30px; border-radius: 8px; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
            <i class="fas fa-tools" style="font-size: 2rem; margin-bottom: 15px;"></i>
            <h3 style="margin-bottom: 5px;">{{ stats.total_trades or 0 }}</h3>
            <p style="margin: 0; opacity: 0.9;">Trade Professionals</p>
            <small style="opacity: 0.8;">({{ stats.verified_trades or 0 }} verified)</small>
        </div>
        <div style="background: #17a2b8; color: white; padding: 30px; border-radius: 8px; text-align: center; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
            <i class="fas fa-clipboard-list" style="font-size: 2rem; margin-bottom: 15px;"></i>
            <h3 style="margin-bottom: 5px;">{{ stats.total_jobs or 0 }}</h3>
            <p style="margin: 0; opacity: 0.9;">Total Jobs</p>
            <small style="opacity: 0.8;">({{ stats.active_jobs or 0 }} active)</small>
        </div>
    </div>

    <!-- Quick Actions -->
    <div style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 40px;">
        <h3 style="color: var(--tradesos-red); margin-bottom: 20px;">
            <i class="fas fa-bolt" style="margin-right: 10px;"></i>QUICK ACTIONS
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <a href="{{ url_for('admin_trades') }}" style="background: var(--tradesos-red); color: white; padding: 15px 20px; text-decoration: none; border-radius: 5px; text-align: center; font-weight: 600; transition: all 0.3s;" onmouseover="this.style.background='var(--tradesos-red-dark)'" onmouseout="this.style.background='var(--tradesos-red)'">
                <i class="fas fa-users" style="margin-right: 8px;"></i>MANAGE TRADES
            </a>
            <button style="background: var(--tradesos-gray-dark); color: var(--tradesos-black); padding: 15px 20px; border: none; border-radius: 5px; font-weight: 600; cursor: pointer;" onclick="alert('Job management feature coming soon')">
                <i class="fas fa-clipboard-list" style="margin-right: 8px;"></i>MANAGE JOBS
            </button>
            <button style="background: var(--tradesos-gray-dark); color: var(--tradesos-black); padding: 15px 20px; border: none; border-radius: 5px; font-weight: 600; cursor: pointer;" onclick="alert('Ad management feature coming soon')">
                <i class="fas fa-ad" style="margin-right: 8px;"></i>MANAGE ADS
            </button>
            <button style="background: var(--tradesos-gray-dark); color: var(--tradesos-black); padding: 15px 20px; border: none; border-radius: 5px; font-weight: 600; cursor: pointer;" onclick="alert('Reports feature coming soon')">
                <i class="fas fa-chart-bar" style="margin-right: 8px;"></i>VIEW REPORTS
            </button>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 40px;">
        <!-- Recent Jobs -->
        <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
            <h4 style="color: var(--tradesos-red); margin-bottom: 20px;">
                <i class="fas fa-clock" style="margin-right: 10px;"></i>RECENT JOBS
            </h4>
            <div>
                {% if recent_jobs %}
                    {% for job in recent_jobs %}
                    <div style="border-bottom: 1px solid #eee; padding: 15px 0;">
                        <div style="display: flex; justify-content: between; align-items: center;">
                            <div style="flex: 1;">
                                <strong style="color: var(--tradesos-black);">{{ job.title[:40] }}{% if job.title|length > 40 %}...{% endif %}</strong><br>
                                <small style="color: var(--tradesos-gray-text);">{{ job.postcode_full }} • {{ job.customer_name or 'Anonymous' }}</small>
                            </div>
                            <div style="text-align: right;">
                                {% if job.urgency == 'emergency_now' %}
                                    <span style="background: var(--tradesos-red); color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">EMERGENCY</span>
                                {% elif job.urgency == 'urgent_2h' %}
                                    <span style="background: #ffc107; color: black; padding: 4px 8px; border-radius: 4px; font-size: 12px;">URGENT</span>
                                {% elif job.urgency == 'same_day' %}
                                    <span style="background: #17a2b8; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">SAME DAY</span>
                                {% else %}
                                    <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">NEXT DAY</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="text-align: center; color: var(--tradesos-gray-text); padding: 30px;">No recent jobs</p>
                {% endif %}
            </div>
        </div>

        <!-- Recent Trades -->
        <div style="background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
            <h4 style="color: var(--tradesos-red); margin-bottom: 20px;">
                <i class="fas fa-user-plus" style="margin-right: 10px;"></i>PENDING TRADE APPLICATIONS
            </h4>
            <div>
                {% if recent_trades %}
                    {% for trade in recent_trades %}
                    <div style="border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: between; align-items: center;">
                        <div style="flex: 1;">
                            <strong style="color: var(--tradesos-black);">{{ trade.company }}</strong><br>
                            <small style="color: var(--tradesos-gray-text);">{{ trade.user.email if trade.user else 'N/A' }} • {{ trade.created_at.strftime('%d/%m/%Y') }}</small>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            {% if trade.verified %}
                                <span style="background: #28a745; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                                    <i class="fas fa-check"></i> VERIFIED
                                </span>
                            {% else %}
                                <span style="background: #ffc107; color: black; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                                    <i class="fas fa-clock"></i> PENDING
                                </span>
                            {% endif %}
                            <a href="{{ url_for('verify_trade', trade_id=trade.id) }}" 
                               style="background: {{ 'var(--tradesos-red)' if not trade.verified else '#ffc107' }}; color: white; padding: 6px 12px; text-decoration: none; border-radius: 4px; font-size: 12px;"
                               onclick="return confirm('{{ 'Verify' if not trade.verified else 'Unverify' }} {{ trade.company }}?')">
                                <i class="fas fa-{{ 'check' if not trade.verified else 'times' }}"></i> {{ 'APPROVE' if not trade.verified else 'REVOKE' }}
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p style="text-align: center; color: var(--tradesos-gray-text); padding: 30px;">No recent trade registrations</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Platform Health -->
    <div style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 40px;">
        <h3 style="color: var(--tradesos-red); margin-bottom: 25px;">
            <i class="fas fa-heartbeat" style="margin-right: 10px;"></i>PLATFORM HEALTH
        </h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
            <div style="border: 2px solid #eee; padding: 20px; border-radius: 8px; text-align: center;">
                <i class="fas fa-percentage" style="font-size: 2rem; color: #28a745; margin-bottom: 10px;"></i>
                <h5 style="margin-bottom: 5px;">Verification Rate</h5>
                <p style="margin: 0; font-size: 1.5rem; font-weight: bold; color: var(--tradesos-red);">
                    {% if stats.total_trades > 0 %}
                        {{ (stats.verified_trades / stats.total_trades * 100)|round(1) }}%
                    {% else %}
                        0%
                    {% endif %}
                </p>
            </div>
            <div style="border: 2px solid #eee; padding: 20px; border-radius: 8px; text-align: center;">
                <i class="fas fa-chart-line" style="font-size: 2rem; color: #17a2b8; margin-bottom: 10px;"></i>
                <h5 style="margin-bottom: 5px;">Job Completion Rate</h5>
                <p style="margin: 0; font-size: 1.5rem; font-weight: bold; color: var(--tradesos-red);">
                    {% if stats.total_jobs > 0 %}
                        {{ ((stats.total_jobs - stats.active_jobs) / stats.total_jobs * 100)|round(1) }}%
                    {% else %}
                        0%
                    {% endif %}
                </p>
            </div>
            <div style="border: 2px solid #eee; padding: 20px; border-radius: 8px; text-align: center;">
                <i class="fas fa-users" style="font-size: 2rem; color: #ffc107; margin-bottom: 10px;"></i>
                <h5 style="margin-bottom: 5px;">Customer to Trade Ratio</h5>
                <p style="margin: 0; font-size: 1.5rem; font-weight: bold; color: var(--tradesos-red);">
                    {% if stats.total_trades > 0 %}
                        {{ (stats.total_customers / stats.total_trades)|round(1) }}:1
                    {% else %}
                        N/A
                    {% endif %}
                </p>
            </div>
            <div style="border: 2px solid #eee; padding: 20px; border-radius: 8px; text-align: center;">
                <i class="fas fa-clock" style="font-size: 2rem; color: var(--tradesos-red); margin-bottom: 10px;"></i>
                <h5 style="margin-bottom: 5px;">System Status</h5>
                <p style="margin: 0;">
                    <span style="background: #28a745; color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold;">ONLINE</span>
                </p>
            </div>
        </div>
    </div>

    <!-- Recent Activity Log -->
    <div style="background: white; padding: 30px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0,0,0,0.1);">
        <h3 style="color: var(--tradesos-red); margin-bottom: 25px;">
            <i class="fas fa-list" style="margin-right: 10px;"></i>RECENT PLATFORM ACTIVITY
        </h3>
        <div style="position: relative; padding-left: 30px;">
            <div style="position: absolute; left: 15px; top: 0; bottom: 0; width: 2px; background: #e9ecef;"></div>
            {% for job in recent_jobs[:3] %}
            <div style="position: relative; margin-bottom: 20px;">
                <div style="position: absolute; left: -35px; top: 5px; width: 10px; height: 10px; border-radius: 50%; background: {{ 'var(--tradesos-red)' if job.urgency == 'emergency_now' else '#17a2b8' }};"></div>
                <div>
                    <h6 style="margin-bottom: 5px; color: var(--tradesos-black);">New {{ job.urgency.replace('_', ' ').title() }} Job Posted</h6>
                    <p style="margin-bottom: 2px; font-size: 14px; color: var(--tradesos-gray-text);">{{ job.title }} in {{ job.postcode_full }}</p>
                    <small style="color: #999;">{{ job.created_at.strftime('%d/%m/%Y %H:%M') }}</small>
                </div>
            </div>
            {% endfor %}
            
            {% for trade in recent_trades[:2] %}
            <div style="position: relative; margin-bottom: 20px;">
                <div style="position: absolute; left: -35px; top: 5px; width: 10px; height: 10px; border-radius: 50%; background: #28a745;"></div>
                <div>
                    <h6 style="margin-bottom: 5px; color: var(--tradesos-black);">New Trade Registration</h6>
                    <p style="margin-bottom: 2px; font-size: 14px; color: var(--tradesos-gray-text);">{{ trade.company }} registered</p>
                    <small style="color: #999;">{{ trade.created_at.strftime('%d/%m/%Y %H:%M') }}</small>
                </div>
            </div>
            {% endfor %}
            
            {% if not recent_jobs and not recent_trades %}
            <p style="text-align: center; color: var(--tradesos-gray-text); padding: 30px;">No recent activity</p>
            {% endif %}
        </div>
    </div>

</div>
{% endblock %}