Build a production-ready web app called TradeSOS in Python using FastAPI + Jinja (or React as a separate frontend served by FastAPI static if preferred) with PostgreSQL via SQLModel/SQLAlchemy, Stripe for subscriptions, and Auth with JWT + OAuth (Google/Apple optional).
Target: MVP that supports emergency trade callouts connecting Customers (homeowners/caretakers) with Trades (verified professionals). UK-focused.
Core Requirements
User Roles & Auth
Roles: Customer, Trade, Admin.
Sign up/in (email+password), email verification, password reset.
JWT access/refresh tokens, role-based route guards.
Admin UI for managing users, reports, payouts, and complaints.
Profiles
Customer profile: name, phone, postcode, addresses, past jobs.
Trade profile: company, VAT/UTR (optional), skills (tags), coverage radius (km), public liability insurance doc upload (S3-like bucket or local), rating, reviews, verification status.
File upload service abstraction (local dev; pluggable for S3).
Jobs (Emergency Callouts)
Customer flow: create job (category, description, photos, postcode, urgency now/within 24h), geocode UK postcode → lat/lon (use a pluggable geocoding service stub; simple UK postcode regex validation).
Real-time matching: select available Trades within radius + matching skills; notify via websocket + email. First accept wins.
Status lifecycle: posted → accepted → en_route → in_progress → completed → canceled.
In-app messaging (job-scoped chat) and location ping (simulate with periodic updates).
Reviews: post-job rating (1–5) + text; affects trade score.
Subscriptions & Billing (Trades)
Plans: Standard £40/mo, Premium £80/mo.
Stripe checkout + webhooks (subscription created, renewed, canceled, payment_failed).
Premium perks: first-access window to new jobs (e.g., 2–5 minutes lead time), priority ranking, access to “enterprise” jobs.
Trade dashboard: active plan, invoices, upgrade/downgrade, cancel.
Advertising & Click-and-Collect (Phase-2 stubs)
Admin can create ad placements (banner/card) with start/end dates; show to Customers in job creation/confirmation views.
Parts list generator (stub): given job description+images, return suggested parts (hard-coded rules now; interface designed for future AI).
Click & Collect: create a “parts basket” entity with supplier name (e.g., B&Q / Travis Perkins), items, indicative price; status: offered/accepted/collected. No real payment integration yet; just data models and UI flow.
Search/Discovery
Public read-only trade directory (SEO-friendly): trade card with skills, coverage, rating; contact via app CTA.
Admin-approved only: hide unverified trades from public.
UK Localisation
Postcode validation, GBP currency, UK date/time.
Timezone Europe/London.
Admin
CRUD for users, trades, jobs, ads, plans.
Moderation: suspend trade, hide listings, refund/cancel job (logic stub).
Data Model (sketch)
User(id, email, password_hash, role, created_at, verified)
Customer(id, user_id, name, phone, postcode, addresses[])
Trade(id, user_id, company, skills[], radius_km, rating_avg, review_count, insurance_url, verified, plan_tier, stripe_customer_id, stripe_sub_id)
Job(id, customer_id, title, category, desc, photos[], postcode, lat, lon, urgency, status, accepted_trade_id, created_at, updated_at)
Message(id, job_id, sender_user_id, text, created_at)
Review(id, job_id, customer_id, trade_id, rating, text, created_at)
AdPlacement(id, name, position, image_url, link_url, starts_at, ends_at, active)
PartsBasket(id, job_id, supplier, items(json), est_total, status)
WebhookEvent(id, provider, payload_json, created_at)
API & Pages
API: /auth/*, /users/*, /trades/*, /jobs/*, /chat/* (websocket), /billing/* (Stripe), /admin/*, /ads/*, /parts/*.
Pages (Jinja or React): login/signup, dashboards (Customer/Trade/Admin), job create & track, trade directory, billing, settings.
Matching Logic (MVP)
Filter trades: verified == true, within radius_km of job location, matching skills.
If Premium: send early notification to Premium first; after “first-access window”, notify Standard.
First trade to click Accept claims the job; lock others.
Tech & Tooling
FastAPI, SQLModel/SQLAlchemy, Alembic migrations.
Pydantic schemas, uvicorn.
Auth: python-jose, passlib, JWT middleware.
Stripe SDK + webhook endpoint with signature verification.
Websockets for job alerts & chat.
Dockerfile + docker-compose (FastAPI + Postgres).
.env support: DATABASE_URL, JWT_SECRET, STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET, APP_ENV.
Logging (structlog/loguru), error handlers.
Tests: pytest + httpx for API, factory fixtures, a few integration tests (auth, job post, match, accept, stripe webhook).
Makefile with make dev, make test, make migrate, make lint.
Seed script to create dummy trades/customers/jobs.
Acceptance Criteria (must pass)
Can create Customer, post an emergency job with a UK postcode, and see at least one nearby verified Trade match.
Premium trade receives job alert before Standard trades (configurable window).
Trade can accept a job; status transitions enforced; chat works.
Stripe subscription can be created/updated/canceled; webhook updates plan tier.
Admin can verify/suspend trades and toggle ad placements.
All protected routes enforce role-based auth; tests run green.
Project Structure (suggested)
app/
  main.py
  api/ (routers: auth, users, trades, jobs, chat, billing, admin, ads, parts)
  models/ (sqlmodel entities)
  schemas/ (pydantic)
  services/ (matching.py, billing.py, email.py, storage.py, geocoding_stub.py)
  deps/ (auth deps, db session)
  core/ (config.py, security.py, logging.py)
  templates/ (jinja pages)  # if SSR
  static/
  tests/
alembic/
Dockerfile
docker-compose.yml
Makefile
README.md
.env.example
README (include)
Quickstart (Replit & Docker)
Env vars